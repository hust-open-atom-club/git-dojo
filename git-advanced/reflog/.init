#!/opt/pwn.college/bash

default_branch=$(sudo -u hacker bash -c '
REPO=/tmp/repo
git init -q "$REPO"
cd "$REPO"
git config user.name  "pwnuser"
git config user.email "pwn@college.edu"
git symbolic-ref --short HEAD
')
echo "$default_branch" > /tmp/branch_commit

# 保存当前提交 hash
FLAG_COMMIT=$(
sudo -u hacker bash -c '
REPO=/tmp/repo
cd "$REPO"
echo "The flag is safe" > secret.txt
git add secret.txt
git commit -q -m "Add secret"
git rev-parse HEAD
')
echo "$FLAG_COMMIT" > /challenge/expected_commit

sudo -u hacker bash -c '
default_branch="$1"
REPO=/tmp/repo
cd "$REPO"
git branch -m feature-x
git checkout -q -b "$default_branch"
git branch -D feature-x 
'bash "$default_branch"

